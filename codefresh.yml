version: '1.0'
steps:
  build_docker_image:
    title: Building Docker Image
    type: build
    image_name: btodhunter/anchore-demo
    working_directory: ./
    dockerfile: Dockerfile

  anchore_scan:
    title: Scanning Docker Image
    image: codefresh/docker-service
    description: Analyzing Image with Anchore Engine.
    commands:
      - curl -s https://raw.githubusercontent.com/anchore/ci-tools/master/scripts/inline_scan | bash -s -- -r ${{build_docker_image}}
  
  push_to_registry:
    title: Pushing to Docker Registry 
    type: push
    candidate: '${{build_docker_image}}'
    tag: codefresh
    registry: dockerhub